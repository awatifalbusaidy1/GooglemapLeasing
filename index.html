<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Qatar</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDPJsDKW08BaA8Am1CCoVGum6jOgcF893Q&callback=initMap" async defer></script>
</head>
<body>
    <input id="search-box" type="text" placeholder="Search a project">
    <div id="map"></div>
    <div id="guide-box">
        <h3>Pin Guide</h3>
        <div class="guide-item">
            <img src="images/sales.png" alt="Sale Icon"> Sale
        </div>
        <div class="guide-item">
            <img src="images/leasing.png" alt="Lease Icon"> Leasing
        </div>
        <div class="guide-item">
            <img src="images/propertymanagement.png" alt="CPQ"> CPQ Managed Properties
        </div>
        <div class="guide-item">
            <img src="images/thirdparty.png" alt="Third Party Icon"> Leasing Third Party
        </div>
        
    </div>
    <script>
        let map, markers = [];
        
        function initMap() {
            
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 25.276987, lng: 51.520008 }, 
                zoom: 9, 
                mapTypeId: "roadmap",
                zoomControl: false, 
                streetViewControl: false, 
                styles: [
            // { featureType: "all", elementType: "labels", stylers: [{ visibility: "off" }] }, //To remove the labels in the map
        ],
            });
    
            fetch("pins.json") // Load pin data
                .then(response => response.json())
                .then(data => {
                    data.pins.forEach(pin => {
                        addMarker(pin);
                    });
                });
    
            document.getElementById("search-box").addEventListener("input", searchPins);
            
        }
        
    
        function addMarker(pin) {
            const icons = {
        "sale": {
            url: "images/sales.png",
            scaledSize: new google.maps.Size(30, 30) // Adjust size here
        },
        "lease": {
            url: "images/leasing.png",
            scaledSize: new google.maps.Size(30, 30)
        },
        "propertymanagement": {
            url: "images/propertymanagement.png",
            scaledSize: new google.maps.Size(30, 30)
        },
        "thirdparty": {
            url: "images/thirdparty.png",
            scaledSize: new google.maps.Size(30,30)
        }
        
    };

    const marker = new google.maps.Marker({
    position: { lat: pin.lat, lng: pin.lng },
    map,
    icon: icons[pin.type.toLowerCase()] || icons["lease"],
    title: pin.title
});
             console.log(marker,"Marker: ");

             const infoWindow = new google.maps.InfoWindow({
                content: `
                    <div style="max-width: 300px;">
                        <img src="${pin.image}" alt="${pin.title}" style="width:100%; height:auto; border-radius: 8px;">
                        <h3 style="margin: 10px 0;">${pin.title}</h3>
                        <p><b>Location:</b> ${pin.description}</p>
                        <p><b>Starting Price:</b> ${pin.price}</p>
                        <p><b>Famous Landmark:</b> ${pin.landmarks}</p>
                        <a href="${pin.link}" target="_blank" style="color: blue; text-decoration: underline;">Project in Salesforce</a>
                    </div>
                `
            });

            // Open info window on marker click
            marker.addListener("click", () => {
                infoWindow.open(map, marker);
                setTimeout(() => {
                    let closeButton = document.querySelector(".gm-ui-hover-effect");
                    if (closeButton) {
                        closeButton.style.backgroundColor = "white"; 
                        closeButton.style.borderRadius = "50%"; 
                        closeButton.style.width = "25px";
                        closeButton.style.height = "25px";
                        closeButton.style.display = "flex";
                        closeButton.style.alignItems = "center";
                        closeButton.style.justifyContent = "center";
                        closeButton.style.boxShadow = "0 2px 5px rgba(0, 0, 0, 0.2)";

                        let closeIcon = closeButton.querySelector("img");
                        if (closeIcon) {
                            closeIcon.remove(); 
                        }

                        closeButton.innerHTML = "✖"; 
                        closeButton.style.fontSize = "16px";
                        closeButton.style.fontWeight = "bold";
                        closeButton.style.color = "black";
                        closeButton.style.cursor = "pointer";
                    }
                }, 200);
});
            
            const landmarkLabel = new google.maps.Marker({
        position: { lat: pin.lat + 0.001, lng: pin.lng }, 
        map,
        icon: {
            path: google.maps.SymbolPath.CIRCLE, 
            scale: 0
        },
        label: {
            text: pin.landmark, 
            color: "#000",
            fontSize: "12px",
            fontWeight: "bold"
        }
    });

            markers.push({ marker, title: pin.title.toLowerCase() });
}

    
function searchPins() {
    const query = document.getElementById("search-box").value.toLowerCase();
    let found = false;

    markers.forEach(({ marker, title }) => {
        if (title.includes(query)) {
            marker.setVisible(true);

            // Zoom into the matched marker
            map.setCenter(marker.getPosition()); 
            map.setZoom(15); 

            found = true;
        } else {
            marker.setVisible(false);
        }
    });

    if (!found) {
        alert("No matching pin found.");
    }
}

fetch("pins.json")
    .then(response => response.json())
    .then(data => {
        console.log("Pins loaded:", data); // ✅ Add this
        data.pins.forEach(pin => {
            addMarker(pin);
        });
    });

    </script>
</body>
</html>
